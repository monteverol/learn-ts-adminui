generator client {
  provider = "prisma-client-js"
  // Prefer default output unless you have a monorepo reason
  // output = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  ACTIVE
  ARCHIVED
}

enum JobCategoryType {
  MAINTENANCE
  OPERATIONS
  OTHER
}

model User {
  id              String           @id @default(cuid())
  name            String
  address         String?
  age             Int?
  status          UserStatus       @default(ACTIVE)
  jobTitle        String?
  jobCategory     JobCategoryType?
  yearsExperience Int?
  bio             String?
  description     String?
  tags            Tag[]            // implicit M2M
  workExperience  WorkExperience[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  deletedAt       DateTime?

  @@index([status])
  @@index([deletedAt])
}

model Tag {
  id    String @id @default(cuid())
  name  String @unique
  users User[]
}

// WORK EXPERIENCE
model WorkExperience {
  id          String    @id @default(cuid())
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  company     String
  position    String
  startDate   DateTime
  endDate     DateTime?
  isCurrent   Boolean   @default(false)
  description String?
  responsibilities Responsibility[]

  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([userId])
}

// RESPONSIBILITIES
model Responsibility {
  id               String          @id @default(cuid())
  workExperience   WorkExperience  @relation(fields: [workExperienceId], references: [id])
  workExperienceId String
  title            String

  @@index([workExperienceId])
}

enum JobCategoryStatus {
  ACTIVE
  ARCHIVED
}

model JobCategory {
  id          String            @id @default(cuid())
  name        String            @unique
  description String?
  status      JobCategoryStatus @default(ACTIVE)
  jobsCount   Int               @default(0)
  avgPrice    Float?
  icon        String?
  color       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  deletedAt   DateTime?
  tags        JobCategoryTag[]

  @@index([status])
  @@index([deletedAt])
}

model JobCategoryTag {
  id            String      @id @default(cuid())
  name          String
  jobCategory   JobCategory @relation(fields: [jobCategoryId], references: [id])
  jobCategoryId String

  @@index([jobCategoryId])
}

enum ServiceStatus {
  ACTIVE
  INACTIVE
}

model Service {
  id             String        @id @default(cuid())
  name           String
  category       String
  price          Float
  duration       String
  status         ServiceStatus @default(ACTIVE)
  description    String?
  providersCount Int           @default(0)
  bookings       Booking[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  deletedAt      DateTime?

  @@index([status])
  @@index([category])
  @@index([deletedAt])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model Booking {
  id           String        @id @default(cuid())
  service      Service       @relation(fields: [serviceId], references: [id])
  serviceId    String
  serviceName  String
  customerName String
  customerPhone String
  date         String
  time         String
  status       BookingStatus @default(PENDING)
  provider     String
  price        Float
  address      String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  deletedAt    DateTime?

  @@index([serviceId])
  @@index([status])
  @@index([date])
  @@index([deletedAt])
}
